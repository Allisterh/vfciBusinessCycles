---
title: "The Price of Risk Drives the Business Cycle"
subtitle: "Brown Macro Breakfast"
title-note: "^1^The views expressed here are the authorsâ€™ and are not necessarily representative of the views of the International Monetary Fund, its Management, or its Executive Directors."
author:
  - name: "Tobias Adrian"
    affiliation: "International Monetary Fund^1^"
  - name: "Matthew DeHaven"
    affiliation: Brown University
  - name: "Fernando Duarte"
    affiliation: Brown University
date: "2024-11-20"
callout-appearance: minimal
editor:
  render-on-save: true
format:
  clean-revealjs:
    self-contained: true
    html-math-method:
        method: mathjax
        url: "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    crossrefs-hover: true
bibliography: references.bib
---

```{r}
#| include: false
library(data.table)
library(tidyfast)
library(vars)
library(fevdid)
library(vfciBCHelpers)
library(purrr)
library(ggplot2)
library(patchwork)
library(gt)
```

```{r}
#| include: false

theme_pres <-
    theme_bw(base_size = 16) +
    theme(
        plot.title = element_text(hjust = 0.5),
        axis.text = element_text(size = 12, margin = margin(0, 0, 0, 0)),
        axis.title = element_text(size = 14),
        plot.caption = element_text(size = 11),
        panel.grid = element_blank(),
        plot.background = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        legend.key = element_blank(),
        legend.position = "top",
        legend.background = element_blank(),
        legend.title = element_text(size = 14),
        legend.margin = margin(0, 0, 0, 0),
        legend.text = element_text(size = 10),
        plot.margin = margin(10, 10, 0, 10, "pt")
        )

var_order <- c(
    VFCI = "vfci",
    Unemployment = "unemployment",
    `Fed Funds` = "interest",
    Inflation = "inflation",
    Output = "output",
    Investment = "investment",
    Consumption = "consumption",
    `Hours Worked` = "hours_worked",
    `Labor Share` = "labor_share",
    TFP = "TFP",
    `Labor Prod.` = "productivity"
)

crossplot_order <- c("Output", "Investment", "Consumption", "Hours Worked", "Fed Funds", "Labor Prod.", "Inflation", "TFP", "VFCI")

irf_horizon <- 32

## Colors
bg_line_color <- "gray50"
recession_color <- "gray80"

hv_macro_color <- "steelblue"
hv_fin_color <- "darkorange"
max_share_color <- "firebrick"
```

```{r var_setup}
lags <- 2
bc_freqs <- c( 2 * pi / 32, 2 * pi / 6)

```

```{r load_recession_dates}
rec_dates <- get_recession_dt()
```

```{r}
vfci_dt <- est_vfci(
  y = "output",
  x = c("pc1", "pc2", "pc3", "pc4"),
  forward = 1
)
```


```{r}
#| include: false
fin_cols <- c("pc1", "pc2", "pc3", "pc4")

data <- get_var_data(
  vfci = NULL,
  end_date = "2022-07-01",
  make_stationary = TRUE
)

hv_macro <-
  data |>
  fit_var(lags = 2) |>
  id_linear_het_reg(
    target = "output",
    hetreg_horizon = 12,
    sign = "neg"
  )
```


```{r}
#| include: false
fin_cols <- c("pc1", "pc2", "pc3", "pc4")

data <- get_var_data(
  vfci = NULL,
  end_date = "2022-07-01",
  add_cols = fin_cols,
  make_stationary = TRUE
)

hv_fin <-
  data[, -c(fin_cols), with = FALSE] |>
  fit_var(lags = 2) |>
  id_linear_het_reg(
    target = "output",
    hetreg_horizon = 12,
    x2 = fin_cols,
    extra_data = data[, fin_cols, with = FALSE],
    method = "mriv",
    sign = "neg"
  )
```

```{r}
#| include: false
#| 
data <- get_var_data(
  vfci = NULL,
  end_date = "2022-07-01",
  make_stationary = TRUE
)

mv <- data |>
  fit_var(lags = 2) |>
  id_fevdfd("unemployment", 2 * pi / c(32, 6), sign = "pos")
```


## Motivation

**Question:** What causes business cycles?

- Empirically, a single shock explains most of the variation in unemployment, output, etc. (@mbc2020).

- Theoretically, models explain this by having a single structural shock that generates this movement (TFP, demand, confidence, etc.).

- Another option is that there is a common propagation mechanism instead of one shock.

The answer determines if business cycles are efficient or inefficient outcomes, with very different implications for welfare and policy.


## What do we do?
We construct two shocks,

1. A shock to macroeconomic uncertainty,
2. And a shock to financial risk compensation.

We find that,

- These two shocks look essentially the same,
- And both explain a large amount of the business cycle,
    - In particular, they explain XX% and YY% of the BCA shock.

## Why does this matter? {#why-matter}

The fact these shocks are so similar implies that the mean and the volatility of macroeconomic variables move together over the business cycle.

This is inconsistent with standard business cycle models that rely upon a single shock.

But it is consistent with a model of financial frictions that are a common propagation mechanism for shocks.

**Takeaway:** This implies that business cycles are partly inefficient outcomes, and that there is a role for policy to improve welfare.

:::{.aside}
[[Related Literature]{.button}](#literature-review)
:::

## Outline

- VAR Setup
    - Construct a macroeconomic uncerainty shock
    - Construct a financial risk compensation shock

- Results
  - Compare impulse response functions and historical shocks
  - Compare to the Business Cycle Anatomy (BCA) shock

- Implications


## VAR Setup

Structural VAR($p$) with $k$ variables in vector $y_t$,
$$
B_0 y_t = B_1 y_{t-1} + . . . + B_p y_{t-p} + w_t
$$
where structural shocks $w_t$ are white noise.

. . .

Estimate reduced-form coefficients $A_i$ and residuals $u_t$,
$$
 y_t = \underbrace{B_0^{-1}B_1}_{A_1} y_{t-1} + \dots + \underbrace{B_0^{-1}B_p}_{A_p} y_{t-p} + \underbrace{B_0^{-1}w_t}_{u_t}
$$

and then the shock identification problem: $u_t = B_0^{-1} w_t$.

## Construct a Macroeconomic Uncertainty Shock

The log variance of the VAR forecast errors is, $\sigma_{t, t + h} = \log \left( \widehat{\text{FE}}_{t, t + h}^2 \right)$.

Then estimate the OLS regression,

$$
\sigma_{t, t + h} = \alpha y_{t} + \varepsilon_t
$$

- Macroeconomic Uncertainty Shock: $\widehat{\alpha} y_t$


## VAR Specification
```{r}
data <- get_var_data(
  vfci = NULL,
  end_date = "2022-07-01",
  make_stationary = TRUE
)
md_start <- as.yearqtr(min(data$date))
md_end <- as.yearqtr(max(data$date))
md_vars <- paste0(var_order[names(var_order) != "VFCI"], sep = ", ", collapse="")
md_vars2 <- substr(md_vars, 1, nchar(md_vars)-2)
```

Time period:

- `r md_start` to `r md_end`, with $p=2$ lags.

Macro Variables ($k = 10$):

- In log differences: output, investment, consumption, hours worked, productivity, TFP
- In levels: unemployment, interest rate, inflation, labor share

Financial Variables (summarized by first 4 principal components):

- S&P 500 returns, S&P 500 volatility, term spread, liquidity spread, credit spread, default spread



##  Macroeconomic Uncertainty Shock
```{r}
#| echo: false
#| fig-width: 10
#| fig-align: 'center'

hv_macro_irf <-
  hv_macro |>
  irf(n.ahead = irf_horizon) |>
  _$irf |>
  as.data.table() |>
  _[impulse == "Chol_1"] |>
  _[, model := "hv_macro"]

hv_macro_irf |>
  ggplot(aes(
    x = h,
    y = irf,
    color = model
  )) +
  geom_hline(yintercept = 0, color = bg_line_color) +
  geom_line() +
  facet_wrap(
    vars(response),
    ncol = 4,
    scales = "free_y"
  ) +
  labs(
    x = "Horizon (quarters)",
    y = "Impulse Response"
  ) +
  scale_color_manual(
    values = c(
      hv_macro = hv_macro_color,
      hv_fin = hv_fin_color
    ),
      labels = c(
        hv_macro = "Macroeconomic Uncertainty",
        hv_fin = "Financial Risk Compensation"
      )
  ) +
  theme_pres +
  theme(legend.position = c(0.8, 0.2))
```

##  Macroeconomic Uncertainty Shock
```{r}
#| echo: false
#| fig-width: 10
#| fig-align: 'center'


hv_macro_hs <-
  hv_macro |>
  hs() |>
  _$hs |>
  as.data.table() |>
  _[impulse == "Chol_1"] |>
  merge(copy(data)[, t := .I - 2][,. (t, date)], by = "t") |>
  _[, model := "hv_macro"]

p1 <-
  hv_macro_hs |>
  {\(.x)
    ggplot() +
    geom_rect(
        data = rec_dates[start %between% as.Date(c("1962-01-01", "2022-01-01"))],
        aes(xmin = start, xmax = end, ymin = -Inf, ymax = +Inf),
        fill = recession_color
      ) +
    geom_hline(yintercept = 0, color = bg_line_color) +
    geom_line(
      data = .x,
      aes(
      x = date,
      y = hs
    ),
      color = hv_macro_color
    ) +
    labs(
      x = NULL,
      y = "Historical Shock",
      title = "(a) Historical Shock"
    ) +
    theme_pres
  }()

hv_macro_hd <-
  hv_macro |>
  fevdid::hd() |>
  _$hd |>
  as.data.table() |>
  _[impulse == "Chol_1"] |>
  _[response == "unemployment"] |>
  merge(copy(data)[, t := .I - 2][,. (t, date)], by = "t") |>
  _[, model := "hv_macro"]

p2 <-
  hv_macro_hd |>
  {\(.x)
    ggplot() +
    geom_rect(
          data = rec_dates[start %between% as.Date(c("1962-01-01", "2022-01-01"))],
          aes(xmin = start, xmax = end, ymin = -Inf, ymax = +Inf),
          fill = recession_color
        ) +
    geom_hline(yintercept = 0, color = bg_line_color) +
    geom_line(
      data = .x,
      aes(
      x = date,
      y = hd
    ),
      color = hv_macro_color
    ) +
    labs(
      x = NULL,
      y = "Unemployment",
      title = "(b) Historical Shock Contribution to Unemployment"
    ) +
    theme_pres
  }()

p1 / p2
```


## Construct a Financial Risk Compensation Shock

The log variance of the VAR forecast errors is, $\sigma_{t, t + h} = \log \left( \widehat{\text{FE}}_{t, t + h}^2 \right)$.

Then estimate the OLS regression,

$$
\sigma_{t, t + h} = \alpha \color{orange}{R_{t}} \color{black}{ + \varepsilon_t}
$$

- Financial Risk Compensation Shock: $\widehat{\alpha} \color{orange}{R_t}$

Where $\color{orange}{R_t}$ are the financial asset principal components.

##  Financial Risk Compensation Shock
```{r}
#| echo: false
#| fig-width: 10
#| fig-align: 'center'

hv_fin_irf <-
  hv_fin |>
  irf(n.ahead = irf_horizon) |>
  _$irf |>
  as.data.table() |>
  _[impulse == "Chol_1"] |>
  _[, model := "hv_fin"]

list_rbind(list(
  hv_fin_irf,
  hv_macro_irf
)) |>
  ggplot(aes(
    x = h,
    y = irf,
    color = model
  )) +
  geom_hline(yintercept = 0, color = bg_line_color) +
  geom_line() +
  facet_wrap(
    vars(response),
    ncol = 4,
    scales = "free_y"
  ) +
  scale_color_manual(
    values = c(
      hv_macro = hv_macro_color,
      hv_fin = hv_fin_color
    ),
      labels = c(
        hv_macro = "Macroeconomic Uncertainty",
        hv_fin = "Financial Risk Compensation"
      )
  ) +
  labs(
    x = "Horizon (quarters)",
    y = "Impulse Response"
  ) +
  theme_pres +
  theme(legend.position = c(0.8, 0.2))
```

##  Financial Risk Compensation Shock
```{r}
#| echo: false
#| fig-width: 10
#| fig-align: 'center'

hv_fin_hs <-
  hv_fin |>
  hs() |>
  _$hs |>
  as.data.table() |>
  _[impulse == "Chol_1"] |>
  merge(copy(data)[, t := .I - 2][,. (t, date)], by = "t") |>
  _[, model := "hv_fin"]

p1 <-
  list_rbind(list(
    hv_fin_hs,
    hv_macro_hs
  )) |>
  {\(.x)
    ggplot() +
    geom_rect(
        data = rec_dates[start %between% as.Date(c("1962-01-01", "2022-01-01"))],
        aes(xmin = start, xmax = end, ymin = -Inf, ymax = +Inf),
        fill = recession_color
      ) +
    geom_hline(yintercept = 0, color = bg_line_color) +
    geom_line(
      data = .x,
      aes(
      x = date,
      y = hs,
      color = model
    )) +
    scale_color_manual(
      values = c(
        hv_macro = hv_macro_color,
        hv_fin = hv_fin_color
      ),
        labels = c(
          hv_macro = "Macroeconomic Uncertainty",
          hv_fin = "Financial Risk Compensation"
        )
    ) +
    labs(
      x = NULL,
      y = "Historical Shock",
      title = "(a) Historical Shock"
    ) +
    theme_pres
  }()

hv_fin_hd <-
  hv_fin |>
  fevdid::hd() |>
  _$hd |>
  as.data.table() |>
  _[impulse == "Chol_1"] |>
  _[response == "unemployment"] |>
  merge(copy(data)[, t := .I - 2][,. (t, date)], by = "t") |>
  _[, model := "hv_fin"]

p2 <-
  list_rbind(list(
    hv_fin_hd,
    hv_macro_hd
  )) |>
  {\(.x)
    ggplot() +
    geom_rect(
          data = rec_dates[start %between% as.Date(c("1962-01-01", "2022-01-01"))],
          aes(xmin = start, xmax = end, ymin = -Inf, ymax = +Inf),
          fill = recession_color
        ) +
    geom_hline(yintercept = 0, color = bg_line_color) +
    geom_line(
      data = .x,
      aes(
      x = date,
      y = hd,
      color = model
    )) +
    scale_color_manual(
      values = c(
        hv_macro = hv_macro_color,
        hv_fin = hv_fin_color
      ),
      labels = c(
        hv_macro = "Macroeconomic Uncertainty",
        hv_fin = "Financial Risk Compensation"
      )
    ) +
    labs(
      x = NULL,
      y = "Unemployment",
      title = "(b) Historical Shock Contribution to Unemployment"
    ) +
    theme_pres
  }()

p1 / p2
```


## Comparison to the Business Cycle Shock

Identify a "main business-cycle" shock $w_t^{(\text{MBC})}$ as in @mbc2020.

1.    Pick a target variable (e.g. unemployment),
2.    Find linear combination of residuals $w_t^{(\text{MBC})} = b^\prime u_t$ that maximizes its contribution of to the variance of target variable over business-cycle frequencies.


##  Comparison to the Business Cycle Shock
```{r}
#| echo: false
#| fig-width: 10
#| fig-align: 'center'

mv_irf <-
  mv |>
  irf(n.ahead = irf_horizon) |>
  _$irf |>
  as.data.table() |>
  _[impulse == "Main"] |>
  _[, model := "mbc"]

list_rbind(list(
  mv_irf,
  hv_fin_irf,
  hv_macro_irf
)) |>
  ggplot(aes(
    x = h,
    y = irf,
    color = model
  )) +
  geom_hline(yintercept = 0, color = bg_line_color) +
  geom_line() +
  facet_wrap(
    vars(response),
    ncol = 4,
    scales = "free_y"
  ) +
  scale_color_manual(
    values = c(
      hv_fin = hv_fin_color,
      hv_macro = hv_macro_color,
      mbc = max_share_color
    ),
      labels = c(
        hv_fin = "Financial Risk Compensation",
        hv_macro = "Macroeconomic Uncertainty",
        mbc = "Main Business Cycle Shock"
      )
  ) +
  labs(
    x = "Horizon (quarters)",
    y = "Impulse Response"
  ) +
  theme_pres +
  theme(legend.position = c(0.8, 0.2))
```

##  Comparison to the Business Cycle Shock
```{r}
#| echo: false
#| fig-width: 10
#| fig-align: 'center'

mv_hs <-
  mv |>
  hs() |>
  _$hs |>
  as.data.table() |>
  _[impulse == "Main"] |>
  merge(copy(data)[, t := .I - 2][,. (t, date)], by = "t") |>
  _[, model := "mbc"]

p1 <-
  list_rbind(list(
    mv_hs,
    hv_fin_hs,
    hv_macro_hs
  )) |>
  {\(.x)
    ggplot() +
    geom_rect(
        data = rec_dates[start %between% as.Date(c("1962-01-01", "2022-01-01"))],
        aes(xmin = start, xmax = end, ymin = -Inf, ymax = +Inf),
        fill = recession_color
      ) +
    geom_hline(yintercept = 0, color = bg_line_color) +
    geom_line(
      data = .x,
      aes(
      x = date,
      y = hs,
      color = model
    )) +
    scale_color_manual(
      values = c(
        hv_fin = hv_fin_color,
        hv_macro = hv_macro_color,
        mbc = max_share_color
      ),
      labels = c(
        hv_fin = "Financial Risk Compensation",
        hv_macro = "Macroeconomic Uncertainty",
        mbc = "Main Business Cycle Shock"
      )
  ) +
    labs(
      x = NULL,
      y = "Historical Shock",
      title = "(a) Historical Shock"
    ) +
    theme_pres
  }()


mv_hd <-
  mv |>
  fevdid::hd() |>
  _$hd |>
  as.data.table() |>
  _[impulse == "Main"] |>
  _[response == "unemployment"] |>
  merge(copy(data)[, t := .I - 2][,. (t, date)], by = "t") |>
  _[, model := "mbc"]


p2 <-
  list_rbind(list(
    mv_hd,
    hv_fin_hd,
    hv_macro_hd
  )) |>
  {\(.x)
    ggplot() +
    geom_rect(
          data = rec_dates[start %between% as.Date(c("1962-01-01", "2022-01-01"))],
          aes(xmin = start, xmax = end, ymin = -Inf, ymax = +Inf),
          fill = recession_color
        ) +
    geom_hline(yintercept = 0, color = bg_line_color) +
    geom_line(
      data = .x,
      aes(
      x = date,
      y = hd,
      color = model
    )) +
    scale_color_manual(
      values = c(
        hv_fin = hv_fin_color,
        hv_macro = hv_macro_color,
        mbc = max_share_color
      ),
        labels = c(
          hv_fin = "Financial Risk Compensation",
          hv_macro = "Macroeconomic Uncertainty",
          mbc = "Main Business Cycle Shock"
        )
    ) +
    labs(
      x = NULL,
      y = "Unemployment",
      title = "(b) Historical Shock Contribution to Unemployment"
    ) +
    theme_pres
  }()

p1 / p2
```


## Shock Correlations

::::{.columns}

:::{.column width="50%"}
```{r}
var_names <- 
  c(
    var_1 = "MBC",
    var_2 = "Fin",
    var_3 = "Macro"
  )

list(
  mv,
  hv_fin,
  hv_macro
) |>
  hs_corr() |>
  _[impulse_x %in% c("Chol_1", "Main") & impulse_y %in% c("Chol_1", "Main")] |>
  _[, .(var_x, var_y, corr)] |>
  _[, var_x := factor(var_x, levels = names(var_names), labels = var_names, ordered = TRUE)] |>
  _[, var_y := factor(var_y, levels = names(var_names), labels = var_names, ordered = TRUE)] |>
  tidyfast::dt_pivot_wider(names_from = var_y, values_from = corr) |>
  gt(rowname_col = "var_x") |>
  tab_header(
    title = "Correlation between Shocks"
  ) |>
  fmt_number(
    columns = 2:4,
    decimals = 2
  ) |>
  tab_options(
    table.font.size = 18
  )
```
:::

:::{.column width="50%"}
```{r}
table_row_names <- c(
  wavg_fevd = "Weighted Average FEVD",
  pct_mbc_wavg = "Pct. of MBC FEVD"
)
model_names <- c(
  mbc = "MBC",
  hv_macro = "Macro",
  hv_fin = "Fin"
)

list(
  mbc = mv,
  hv_fin = hv_fin,
  hv_macro = hv_macro
) |>
  map(~ fevfd(.x)$fevfd) |>
  list_rbind(names_to = "model") |>
  as.data.table() |>
  _[, total := sum(fevfd), by = .(model, f, response)] |>
  _[impulse %in% c("Main", "Chol_1")] |>
  _[f %between% (2 * pi / c(32, 6))] |>
  _[, .(
    fevfd = sum(fevfd),
    total = sum(total)
  ), by = .(
    impulse, response, model
  )] |>
  _[, wavg_fevd := fevfd / total] |>
  _[response == "unemployment"] |>
  _[, mbc_wavg := max(wavg_fevd)] |>
  _[, pct_mbc_wavg := wavg_fevd / mbc_wavg] |>
  _[, .(model, wavg_fevd, pct_mbc_wavg)]  |>
  dt_pivot_longer(-model) |>
  _[, model := factor(model, levels = names(model_names), labels = model_names, ordered = TRUE)] |>
  dt_pivot_wider(names_from = model, values_from = value) |>
  _[, name := factor(name, levels = names(table_row_names), labels = table_row_names, ordered = TRUE)] |>
  gt(rowname_col = "name") |>
  tab_header(
    title = "Forecast Error Variance Decompositions (FEVD)"
  ) |>
  fmt_percent(
    columns = 2:4,
    decimals = 1
  ) |>
  tab_options(
    table.font.size = 18
  )

```

:::
::::


## Implications



# Appendix {.appendix visibility="uncounted"}


## References {visibility="uncounted"}

::: {#refs}
:::

## Select Related Literature {#literature-review visibility="uncounted"}

@mbc2020

- 

@adrian2023

- 

:::{.aside}
[[Why does this Matter?]{.button}](#why-matter)
:::